<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>College Football Battleship</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="css/index.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/2.0.1/css/dataTables.dataTables.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/selectize.js/0.15.2/css/selectize.default.min.css" integrity="sha512-pTaEn+6gF1IeWv3W1+7X7eM60TFu/agjgoHmYhAfLEU8Phuf6JKiiE8YmsNC0aCgQv4192s4Vai8YZ6VNM6vyQ==" crossorigin="anonymous" referrerpolicy="no-referrer"/>
</head>
<body>
    <header>
        <nav class="navbar">
            <a href="#" class="nav-branding">Battleship</a>

            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="#" class="nav-link" id="navPicks">Make Picks</a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" id="navGroups">Groups</a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" id="navAbout">About</a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" id="navLogin">Login</a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" id="navSignup">Signup</a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" id="btnNavLogout">Signout</a>
                </li>
            </ul>
            <div class="hamburger">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </div>
        </nav>
    </header>
    <div class="d-flex flex-wrap col-12 col-md-8 col-lg-8 offset-md-2 offset-lg-2 justify-content-center align-items-center vh-100">
        <!-- Login Card -->
        <div id="divLogin" class="card col-12 text-black" style="display: none;">
            <div class="d-flex card-header justify-content-center">
                <h3>Login To Battleship</h3>
            </div>
            <div class="card-body">
                <form>
                    <label for="txtLoginEmail" class="form-label">Email</label>
                    <input id="txtLoginEmail" class="form-control" type="email">
                    <label for="txtLoginPassword" class="form-label mt-3">Password</label>
                    <input id="txtLoginPassword" class="form-control" type="password">
                    <div class="d-flex justify-content-evenly mt-3">
                        <button id="btnLogin" class="btn btn-primary col-5" type="button">Login</button>
                        <button id="btnRegistration" class="btn btn-success col-5" type="button">Register</button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Register Card -->
        <div id="divRegister" class="card col-12 text-black" style="display: none;">
            <div class="d-flex card-header justify-content-center">
                <h3>Register For Battleship</h3>
            </div>
            <div class="card-body">
                <form>
                    <label for="txtRegisterFirstName" class="form-label">First Name</label>
                    <input id="txtRegisterFirstName" class="form-control" type="text">
                    <label for="txtRegisterLastName" class="form-label mt-3">Last Name</label>
                    <input id="txtRegisterLastName" class="form-control" type="text">
                    <label for="txtRegisterUsername" class="form-label mt-3">Username</label>
                    <input id="txtRegisterUsername" class="form-control" type="text">
                    <label for="txtRegisterEmail" class="form-label mt-3">Email</label>
                    <input id="txtRegisterEmail" class="form-control" type="email">
                    <label for="txtRegisterPassword" class="form-label mt-3">Password</label>
                    <input id="txtRegisterPassword" class="form-control" type="password">
                    <label for="txtConfirmPassword" class="form-label mt-3">Confirm Password</label>
                    <input id="txtConfirmPassword" class="form-control" type="password">
                    <div class="d-flex justify-content-evenly mt-3">
                        <button id="btnRegister" class="btn btn-primary col-5" type="button">Complete Registration</button>
                        <button id="btnBackToLogin" class="btn btn-secondary col-5" type="button">Back To Login</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Dashboard Card -->
        <div id="divDashboard" class="card col-12 text-black" style="display: none;">
            <div class="d-flex card-header justify-content-center">
                <h3>Welcome To Battleship</h3>
            </div>
            <div class="d-flex card-body justify-content-center">
                <div class="col-12">
                    <div>
                        <div class="row">
                            <div class="column">
                                <div class="cardGroups">
                                    <h5>Make Picks</h5>
                                    <hr>
                                    <p>Click in the table on the row with the group you want to make picks for this week's games.</p>
                                </div>
                            </div>
                            <div class="column">
                                <div class="cardGroups">
                                    <h5>About</h5>
                                    <hr>
                                    <p>Picking a team must be made before that game's scheduled start time, with the option to make their picks at any time during the week, rather than all at once.</p>
                                </div>
                            </div>
                        </div>
                        <hr>
                        <h5 class="d-flex justify-content-center">Your Groups</h5>
                        <table id="tblPicksGroups" class="table table-striped" style="width: 100%;">
                            <thead>
                                <tr><th>Group Name</th><th>Owner</th></tr>
                            </thead>
                            <tbody>
                                
                            </tbody>
                        </table>
                    </div>
                    <hr>
                    <div class="d-flex justify-content-center">
                        <button id="btnLogout" class="btn btn-primary col-5" type="button">Logout</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Groups Card -->
        <div id="divGroups" class="card col-12 text-black" style="display: none;">
            <div class="d-flex card-header justify-content-center">
                <h3>Groups</h3>
            </div>
            <div class="d-flex card-body justify-content-center" style="flex-direction: column;">
                <div class="row">
                    <div class="column">
                        <div class="cardGroups">
                            <h5>Create a Group</h5>
                            <hr>
                            <button class="btn btn-primary col-8" type="button" id="btnNewGroup">Create New Group</button>
                        </div>
                    </div>
                    <div class="column">
                        <div class="cardGroups">
                            <h5>How to Join a group</h5>
                            <hr>
                            <p>
                                To join a group, first find the group you want to join then click anywhere on the row containing that group.
                                You will then be asked if you'd like to join that group.
                                <p></p>
                                You can no longer join a group after the first game of the season has started.
                            </p>
                        </div>
                    </div>
                </div>
                <hr>
                <div class="d-flex justify-content-center">
                    <h5>All Groups</h5>
                </div>
                <table id="tblGroups" class="table table-striped" style="width: 100%;">
                    <thead>
                        <tr><th>Group Name</th><th>Owner</th><th>Number of Participants</th></tr>
                    </thead>
                    <tbody>
                        
                    </tbody>
                </table>
                <hr>
                <div class="row">
                    <div class="columnYourGroups">
                        <div class="cardGroups">
                            <h5>How to View Your Groups</h5>
                            <hr>
                            <p>To view the groups you are a part of, simply click on the group's row.</p>
                        </div>
                    </div>
                </div>
                <hr>
                <div class="d-flex justify-content-center">
                    <h5>Your Groups</h5>
                </div>
                <table id="tblYourGroups" class="table table-striped" style="width: 100%;">
                    <thead>
                        <tr><th>Group Name</th><th>Owner</th><th>Number of Participants</th></tr>
                    </thead>
                    <tbody>
                        
                    </tbody>
                </table>
            </div>
        </div>

        <!-- About Card (About Game and Rules)-->
        <div id="divAbout" class="card col-12 text-black" style="display: none;">
            <div class="d-flex card-header justify-content-center">
                <h2>About Battleship and How to Play</h3>
            </div>
            <div class="d-flex card-body justify-content-center" style="flex-direction: column;">
                <h4>About College Football Battleship:</h5>
                <p style="margin-left: 20px; margin-right: 20px;"> 
                    College Football Battleship is a thrilling and strategic game that puts your predictive skills to the test in the realm 
                    of college football. Inspired by the classic game of Battleship, where players strategically place their ships and attempt 
                    to sink their opponent's fleet, Battleship College Football adds a new twist by challenging players to navigate the 
                    unpredictable waters of collegiate gridiron action.
                </p>
                <hr>
                <p><h6>To Begin Playing:</h6> Create an account then go to the groups tab. There you can either create or join a group.</p>
                <hr>
                <h4>How To Play:</h5>
                <ol>
                    <li><h6>Initial Picks:</h6> At the beginning of the season, each player starts with 7 picks for the first week of college football matchups.</li>
                    <p></p>
                    <li><h6>Weekly Picks:</h6> Every week, players must select one college football team they believe will win their game. The picked team must be an FBS team.</li>
                    <p></p>
                    <li><h6>No Repicks:</h6> Once a team is selected by a player, they cannot choose that team again for the rest of the season. Strategy is key as players must carefully consider when to use their picks on favored teams versus underdogs.</li>
                    <p></p>
                    <li><h6>Consequences of Losses:</h6> If the team chosen by a player loses their game or a pick is not made, the player's available picks decrease. For example, if a player loses one pick in a given week, they will have only 6 picks remaining for the following week. This reduction in available picks continues for each incorrect pick.</li>
                    <p></p>
                    <li><h6>Minimum Picks:</h6> Players must always have at least one pick available each week. If a player reaches zero picks, they may be eliminated from the game.</li>
                    <p></p>
                    <li><h6>Strategic Planning:</h6> Players must strategize wisely, balancing their picks between strong favorites and potential upsets throughout the season. As the number of available picks dwindles, the game becomes more intense, requiring careful consideration of each selection.</li>
                    <p></p>
                    <li><h6>Victory:</h6> The last player remaining with picks available at the end of the season is declared the winner of Battleship College Football, demonstrating their mastery of college football prediction and strategic foresight. In case of a tie, the players in the </li>
                    <p></p>
                    <li><h6>Tiebreaker:</h6> If tied, the player who held the higher number of picks for the longest time wins. For example, if both players end with 4 picks, the one who dropped to 4 picks later in the season wins.</li>
                </ol>
                <hr>
                <p>Created by: Hayden Jones</p>
                <p><a href="mailto:collegefootballbattleship@gmail.com">Contact: collegefootballbattleship@gmail.com</a></p>
                <p>&copy; 2024 College Football Battleship. All rights reserved.</p>
            </div>
        </div>

        <!-- Group Members Card-->
        <div id="divGroupMembers" class="card col-12 text-black" style="display: none;">
            
        </div>

        <!-- Member Picks Card -->
        <div id="divMemberPicks" class="card col-12 text-black" style="display: none;">
            <div class="card-header">
                
            </div>
            <div class="card-body">

            </div>
        </div>

        <!-- Make Picks Card -->
        <div id="divMakePicks" class="card col-12 text-black" style="display: none;">
            <div class="d-flex card-header justify-content-center">
                
            </div>
            <div class="d-flex card-body justify-content-center" style="flex-direction: column;">
                
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.datatables.net/2.0.1/js/dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/3.0.0/js/dataTables.buttons.js"></script>
    <script src="https://cdn.datatables.net/buttons/3.0.0/js/buttons.bootstrap5.js"></script>
    <script src="https://cdn.datatables.net/buttons/3.0.0/js/buttons.dataTables.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
    <script src="https://cdn.datatables.net/buttons/3.0.0/js/buttons.html5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/selectize.js/0.15.2/js/selectize.min.js" integrity="sha512-IOebNkvA/HZjMM7MxL0NYeLYEalloZ8ckak+NDtOViP7oiYzG5vn6WVXyrJDiJPhl4yRdmNAG49iuLmhkUdVsQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdn.datatables.net/buttons/3.0.0/js/buttons.print.min.js"></script>
    <script>
        // regex for email validation
        const regEmail = /[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/;
        
        // Global Variables
        let userID;
        let groupID;
        let week;

        /* Functions */

        // Logout Function
        function logout() {
            let strSessionID = sessionStorage.getItem('SessionID')
            $.ajax({
                url: 'https://collegefootballbattleship-bae9a8eebbcaacff.eastus-01.azurewebsites.net/sessions?SessionID=' + strSessionID,
                type: 'DELETE',
                success: function(){
                    sessionStorage.removeItem('SessionID');
                    userID = '';
                    // Slide up the current card (if it's not already hidden)
                    $('.card:visible').slideUp(function(){
                        // Slide down the dashboard card
                        $('#divAbout').slideDown(function(){
                            location.reload();
                        });
                    });
                }
            })
        }

        // Function to convert ISO string to local 12 hour time
        function convertTo12HourFormat(isoString) {
            const date = new Date(isoString);
            let hours = date.getHours();
            const minutes = date.getMinutes();
            const seconds = date.getSeconds();
            const milliseconds = date.getMilliseconds();
            const ampm = hours >= 12 ? 'PM' : 'AM';
            
            // Convert to 12-hour format
            hours = hours % 12;
            hours = hours ? hours : 12; // the hour '0' should be '12'

            // Pad minutes, seconds, and milliseconds with leading zeros if needed
            const strMinutes = minutes < 10 ? '0' + minutes : minutes;
            const strSeconds = seconds < 10 ? '0' + seconds : seconds;
            const strMilliseconds = milliseconds < 100 ? '0' + milliseconds : milliseconds;

            return `${hours}:${strMinutes} ${ampm}`;
        }

        // Function to check if game has started
        function checkGameStart(gameTime) {
            const currentTime = new Date();
            const gameStartTime = new Date(gameTime);
            if(currentTime < gameStartTime) {
                return false;
            } else {
                return true;
            }
        }

        // getUserID to assign to global variable
        function getUserID(callback) {
            $.get('https://collegefootballbattleship-bae9a8eebbcaacff.eastus-01.azurewebsites.net/userID?SessionID=' + sessionStorage.getItem('SessionID'), function(result){
                if(result.message == "success") {
                    callback(result.userID)
                } else {
                    Swal.fire({
                        title: "Oops",
                        text: "SessionID is invalid, Please signout then re-login"
                    })
                }
            })
        }

        // Function to get all groups
        function getGroups(callback) {
            $.get('https://collegefootballbattleship-bae9a8eebbcaacff.eastus-01.azurewebsites.net/groups', function(result){
                callback(result);
            });
        }

        // Display the groups in a table
        function displayGroupsTable() {
            getGroups(function(groups){
                var promise = new Promise((resolve, reject) => {
                    
                    groups.forEach((value, index, array) => {
                        $.get('https://collegefootballbattleship-bae9a8eebbcaacff.eastus-01.azurewebsites.net/groupmembers?groupID=' + value.GroupID, function(result){
                            let arrMembers = result.members;
                            let numMembers = arrMembers.length;
                            let strRow = '<tr data-value="' + value.GroupID + '"><td>' + value.GroupName + '</td><td>' + value.OwnerName + '</td><td>' + numMembers + '</td></tr>'
                            $('#tblGroups tbody').append(strRow);
                            if (index === array.length -1) resolve();
                        })
                    })
                })

                promise.then(() => {
                    $('#tblGroups').DataTable({
                        fixedHeader: true,
                        responsive: true,
                        columnDefs: [
                            {
                                targets: '_all',
                                className: 'dt-head-center',
                            },
                            {
                                targets: '_all',
                                className: 'dt-body-center',
                            }
                        ]
                    })
                })
            });    
        }

        // Get the groups that the user is a part of
        function getYourGroups(callback) {
            $.get('https://collegefootballbattleship-bae9a8eebbcaacff.eastus-01.azurewebsites.net/groupsByUserID?userID=' + userID, function(result){
                callback(result);
            })
        }

        // Display the groups that the user is a part of
        function displayYourGroups() {
            getYourGroups(function(groups){
                groups = groups.groups;
                var promise = new Promise((resolve, reject) => {
                    
                    groups.forEach((value, index, array) => {
                        $.get('https://collegefootballbattleship-bae9a8eebbcaacff.eastus-01.azurewebsites.net/groupByID?groupID=' + value.GroupID, function(groupInfo){
                            $.get('https://collegefootballbattleship-bae9a8eebbcaacff.eastus-01.azurewebsites.net/groupmembers?groupID=' + value.GroupID, function(result){
                                let arrMembers = result.members;
                                let numMembers = arrMembers.length;
                                let strRow = '<tr data-value="' + value.GroupID + '"><td>' + value.GroupName + '</td><td>' + groupInfo.OwnerName + '</td><td>' + numMembers + '</td></tr>'
                                $('#tblYourGroups tbody').append(strRow);
                                if (index === array.length -1) resolve();
                            })
                        })
                    })
                })

                promise.then(() => {
                    $('#tblYourGroups').DataTable({
                        fixedHeader: true,
                        responsive: true,
                        columnDefs: [
                            {
                                targets: '_all',
                                className: 'dt-head-center',
                            },
                            {
                                targets: '_all',
                                className: 'dt-body-center',
                            }
                        ]
                    })
                })
            })
        }

        function displayGroupMembersCard(groupID) {
            $.get('https://collegefootballbattleship-bae9a8eebbcaacff.eastus-01.azurewebsites.net/groupmembers?groupID=' + groupID, function(result){
                let members = result.members;
                let strHTML = `
                    <div class="d-flex card-header justify-content-center">
                        <h3>Group Members</h3>
                    </div>
                    <div class="d-flex card-body justify-content-center" style="flex-direction: column;">
                        <table id="tblGroupMembers" class="table table-striped" style="width: 100%;">
                            <thead>
                                <tr><th>Member Name</th><th>Picks Per Week</th><th>Last Lost Pick Week</th></tr>
                            </thead>
                            <tbody>
                                
                            </tbody>
                        </table>
                        <div id="divBtn">

                        </div>
                    </div>`;
                $('#divGroupMembers').html(strHTML);    
                
                let promise = new Promise((resolve, reject) => {
                    members.forEach((member, index, array) => {
                        $.get('https://collegefootballbattleship-bae9a8eebbcaacff.eastus-01.azurewebsites.net/picksLeft?userID=' + member.UserID + '&groupID=' + groupID, function(result){
                            $.get('https://collegefootballbattleship-bae9a8eebbcaacff.eastus-01.azurewebsites.net/lastLostWeek?userID=' + member.UserID + '&groupID=' + groupID, function(lastLostWeek){
                                // Check if lastLostWeek is empty (no picks lost)
                                if (lastLostWeek.lastLostWeek.length < 1) {
                                    lastLostWeek.lastLostWeek = [{Week: '1'}];
                                    let strRow = '<tr data-value=' + member.UserID +'><td>' + member.Username + '</td><td>' + result.picksLeft + '</td><td>' + lastLostWeek.lastLostWeek + '</td></tr>';
                                    $('#tblGroupMembers tbody').append(strRow);
                                } else {
                                    let strRow = '<tr data-value=' + member.UserID +'><td>' + member.Username + '</td><td>' + result.picksLeft + '</td><td>' + lastLostWeek.lastLostWeek + '</td></tr>';
                                    $('#tblGroupMembers tbody').append(strRow);
                                }
                                if (index === array.length -1) resolve();
                            })
                        })
                    })
                });

                promise.then(() => {
                    $('#tblGroupMembers').DataTable({
                        fixedHeader: true,
                        responsive: true,
                        columnDefs: [
                            {
                                targets: '_all',
                                className: 'dt-head-center',
                            },
                            {
                                targets: '_all',
                                className: 'dt-body-center',
                            }
                        ],
                        order: [[1, 'desc'],[2, 'desc']]
                    });

                    strHTML = `<button id="btnBackToGroups" class="btn btn-primary col-12 mt-3" type="button">Back To Groups</button>`;
                    $('#divBtn').append(strHTML);
                    
                    $('#divGroups').slideUp(function(){
                        $('#divGroupMembers').slideDown();
                    })
                });
            })
        }

        // Add new row to groups datatable
        function addGroupRow(groupName, ownerName, numMembers) {
            let table = $('#tblGroups').DataTable();
            let newRow = [
                groupName,
                ownerName,
                numMembers
            ];
            table.row.add(newRow).draw();
        }

        function addYourGroupRow(groupName, ownerName, numMembers) {
            let table = $('#tblYourGroups').DataTable();
            let newRow = [
                groupName,
                ownerName,
                numMembers
            ];
            table.row.add(newRow).draw();
        }


        function addToPicksGroups(groupName, ownerName) {
            let table = $('#tblPicksGroups').DataTable();
            let newRow = [
                groupName,
                ownerName
            ];
            table.row.add(newRow).draw();
        }

        function displayPicksGroups () {
            getYourGroups(function(groups){
                groups = groups.groups;
                var promise = new Promise((resolve, reject) => {
                    
                    groups.forEach((value, index, array) => {
                        $.get('https://collegefootballbattleship-bae9a8eebbcaacff.eastus-01.azurewebsites.net/groupByID?groupID=' + value.GroupID, function(groupInfo){
                            let strRow = '<tr data-value="' + value.GroupID + '"><td>' + value.GroupName + '</td><td>' + groupInfo.OwnerName + '</td></tr>'
                            $('#tblPicksGroups tbody').append(strRow);
                            if (index === array.length -1) resolve();
                        })
                    })
                })

                promise.then(() => {
                    $('#tblPicksGroups').DataTable({
                        fixedHeader: true,
                        responsive: true,
                        columnDefs: [
                            {
                                targets: '_all',
                                className: 'dt-head-center',
                            },
                            {
                                targets: '_all',
                                className: 'dt-body-center',
                            }
                        ]
                    })
                })
            
            })
        }

        /* End Functions */

        // When the document is ready load everything needed
        $(document).ready(function(){
            displayGroupsTable();
            if (sessionStorage.getItem('SessionID')) {
                // get userID
                getUserID(function(result){
                    // set global userID
                    userID = result;
                    displayPicksGroups();
                    displayYourGroups();
                });
                $('#divDashboard').slideToggle();
            } else if (!sessionStorage.getItem('SessionID')) {
                $('#divAbout').slideToggle();
            }
        })

        //login the user
        $('#btnLogin').on('click', function(){
            let strEmail = $('#txtLoginEmail').val();
            let strPassword = $('#txtLoginPassword').val();

            let blnError = false;
            let strErrorMessage = '';
            if (strEmail.length < 1){
                blnError = true;
                strErrorMessage = strErrorMessage + 'Email cannot be blank.  ';
            }
            if (strPassword.length < 1){
                blnError = true;
                strErrorMessage = strErrorMessage + 'Password cannot be blank.  ';
            }
            if (blnError == true){
                Swal.fire({
                    title: "Oops",
                    text: strErrorMessage,
                    icon: "error"
                });
            } else {
                $.get('https://collegefootballbattleship-bae9a8eebbcaacff.eastus-01.azurewebsites.net/users?email=' + strEmail + '&password=' + strPassword, function(result){
                    if (!result.error){
                        let strUserID = result.userID;
                        userID = strUserID;     //set globalUserID
                        $.post('https://collegefootballbattleship-bae9a8eebbcaacff.eastus-01.azurewebsites.net/sessions', {email: strEmail, password: strPassword}, function(result){
                            if(result.Error){
                                Swal.fire({
                                    title: "Oops",
                                    html: '<p>' + result.Error  + '</p>',
                                    icon: "error"
                                });
                            } else {
                                sessionStorage.setItem('SessionID', result.sessionid)
                                displayPicksGroups();
                                displayYourGroups();
                                Swal.fire({
                                    title: "Success",
                                    text: "User and Session Created",
                                    icon: "success"
                                })
                                $('#divLogin').slideToggle(function(){
                                    $('#divDashboard').slideToggle();
                                })
                            }
                        })
                    } else {
                        Swal.fire({
                            title:"Incorrect Credentials",
                            text: "Incorrect Credentials Were Provided",
                            icon: "error"
                        })
                    }
                })
            }
        })
        
        // Register User
        $('#btnRegister').on('click', function(){
            let strFirstName = $('#txtRegisterFirstName').val();
            let strLastName = $('#txtRegisterLastName').val();
            let strUsername = $('#txtRegisterUsername').val();
            let strEmail = $('#txtRegisterEmail').val();
            let strPassword = $('#txtRegisterPassword').val();
            let strConfirmPassword = $('#txtConfirmPassword').val();

            let strError = '';

            if(strPassword === strConfirmPassword) {
                // Input Validation
                let blnError = false;
                if (strFirstName < 1) {
                    blnError = true;
                    strError += 'First name cannot be blank.  ';
                }
                if (strLastName < 1) {
                    blnError = true;
                    strError += 'Last name cannot be blank.  ';
                }
                if (strUsername < 1) {
                    blnError = true;
                    strError += 'Last name cannot be blank.  ';
                }
                if (!regEmail.test(strEmail)) {
                    blnError = true;
                    strError += 'Invalid Email Format.  ';
                }
                if (strPassword < 1) {
                    blnError = true;
                    strError += 'Password cannot be blank.  ';
                }

                if (blnError) {
                    Swal.fire({ icon: 'error', title: 'Uh oh!', text: strError });
                } else {
                    // Create an object to hold the form data
                    let formData = {
                        firstName: strFirstName,
                        lastName: strLastName,
                        username: strUsername,
                        email: strEmail,
                        password: strPassword
                    };
                
                    // call post to users to create a new user
                    $.post('https://collegefootballbattleship-bae9a8eebbcaacff.eastus-01.azurewebsites.net/users', formData, function(result){
                        if (result.Error){
                            Swal.fire({
                                title: "Oops!",
                                icon: "error",
                                text: result.Error
                            })
                        } else {
                            userID = result.userID;
                            $.post('https://collegefootballbattleship-bae9a8eebbcaacff.eastus-01.azurewebsites.net/sessions', {email: strEmail, password: strPassword}, function(result){
                                if(result.Error){
                                    Swal.fire({
                                        title: "Oops",
                                        html: '<p>' + result.Error  + '</p>',
                                        icon: "error"
                                    });
                                } else {
                                    sessionStorage.setItem('SessionID', result.sessionid)
                                    Swal.fire({
                                        title: "Success",
                                        text: "User and Session Created",
                                        icon: "success"
                                    })
                                    $('#divRegister').slideToggle(function(){
                                        $('#divDashboard').slideToggle();
                                    })
                                }
                            })
                        }
                    })
                }
            } else {
                Swal.fire({
                    title: "Passwords Do Not Match",
                    text: "Passwords do not match, please try again",
                    icon: "error"
                })
            }
        })

        //logout the user
        $('#btnNavLogout').on('click', function(){
            logout();
        })

        $('#btnLogout').on('click', function(){
            logout();
        })
        
        // Login To Registration
        $('#btnRegistration').on('click', function(){
            $('#divLogin').slideToggle(function(){
                $('#divRegister').slideToggle();
            })
        })

        // Registration to Login
        $('#btnBackToLogin').on('click', function(){
            $('#divRegister').slideToggle(function(){
                $('#divLogin').slideToggle();
            })
        })

        // Go from divGroupMembers to divGroups
        $(document).on('click', '#btnBackToGroups', function(){
            $('#divGroupMembers').slideUp(function(){
                $('#divGroups').slideDown();
            })
        })

        /*
            Nav Menu Functionality Start
        */
        const hamburger = document.querySelector('.hamburger');
        const navMenu = document.querySelector('.nav-menu');

        // Event Listener for Hamburger
        hamburger.addEventListener('click', function(){
            hamburger.classList.toggle('active');
            navMenu.classList.toggle('active');
        })

        // Event Listener for Nav Links
        document.querySelectorAll('.nav-link').forEach(function(navLink){
            navLink.addEventListener('click', function(){
                hamburger.classList.remove('active');
                navMenu.classList.remove('active');
            })
        })

        // Go to Picks from anywhere
        $('#navPicks').on('click', function(e){
            e.preventDefault(); // Prevent the default link behavior

            // check if logged in
            if (sessionStorage.getItem('SessionID')) {
                // Slide up the current card (if it's not already hidden)
                $('.card:visible').slideUp(function(){
                    // Slide down the dashboard card
                    location.reload();
                });
            } else {
                Swal.fire({
                    title: "Not Logged In",
                    text: "You must be logged in to view this page",
                    icon: "error",
                    showConfirmButton: true,
                    confirmButtonText: "Go To Login Page?",
                    showCancelButton: true,
                    cancelButtonText: "Stay Here",
                    customClass: {
                        actions: 'my-actions',
                        confirmButton: 'order-1 right-gap',
                        cancelButton: 'order-2'
                    },
                }).then((result) => {
                    if (result.isConfirmed) {
                        $('.card:visible').slideUp(function(){
                            $('#divLogin').slideDown();
                        });
                    }
                })
            }
        });

        // Go to groups from anywhere
        $('#navGroups').on('click', function(e){
            e.preventDefault(); // Prevent the default link behavior
            // Slide up the current card (if it's not already hidden)
            $('.card:visible').slideUp(function(){
                // Slide down the dashboard card
                $('#divGroups').slideDown();
            });
        });

        // Go to about from anywhere
        $('#navAbout').on('click', function(e){
            e.preventDefault(); // Prevent the default link behavior
            // Slide up the current card (if it's not already hidden)
            $('.card:visible').slideUp(function(){
                // Slide down the dashboard card
                $('#divAbout').slideDown();
            });
        });

        // Go to login from anywhere
        $('#navLogin').on('click', function(e){
            if (!sessionStorage.getItem('SessionID')) {
                e.preventDefault(); // Prevent the default link behavior
                // Slide up the current card (if it's not already hidden)
                $('.card:visible').slideUp(function(){
                    // Slide down the dashboard card
                    $('#divLogin').slideDown();
                });
            } else {
                Swal.fire({
                    title: "Already Logged In",
                    text: "You are already logged in would you like to log out?",
                    icon: "error",
                    showConfirmButton: true,
                    confirmButtonText: "Logout",
                    showCancelButton: true,
                    cancelButtonText: "Stay Logged In",
                    customClass: {
                        actions: 'my-actions',
                        confirmButton: 'order-1 right-gap',
                        cancelButton: 'order-2'
                    },
                }).then((result) => {
                    if (result.isConfirmed) {
                        logout();
                    }
                })
            }
            
        });

        // Go to signup from anywhere
        $('#navSignup').on('click', function(e){
            if (!sessionStorage.getItem('SessionID')) {
                e.preventDefault(); // Prevent the default link behavior
                // Slide up the current card (if it's not already hidden)
                $('.card:visible').slideUp(function(){
                    // Slide down the dashboard card
                    $('#divRegister').slideDown();
                });
            } else {
                Swal.fire({
                    title: "Already Logged In",
                    text: "You are already logged in would you like to log out to create a new account?",
                    icon: "error",
                    showConfirmButton: true,
                    confirmButtonText: "Logout",
                    showCancelButton: true,
                    cancelButtonText: "Stay Logged In",
                    customClass: {
                        actions: 'my-actions',
                        confirmButton: 'order-1 right-gap',
                        cancelButton: 'order-2'
                    },
                }).then((result) => {
                    if (result.isConfirmed) {
                        let strSessionID = sessionStorage.getItem('SessionID')
                        $.ajax({
                            url: 'https://collegefootballbattleship-bae9a8eebbcaacff.eastus-01.azurewebsites.net/sessions?SessionID=' + strSessionID,
                            type: 'DELETE',
                            success: function(){
                                sessionStorage.removeItem('SessionID');
                                userID = '';
                                $('#divDashboard').slideUp(function () {
                                    $('#divAbout').slideDown(function(){
                                        location.reload();
                                    });
                                });
                            }
                        })
                    }
                })
            }
            
        });
        /*
            Nav Menu Functionality End
        */

        // Functionality for create new group using a sweet alert
        $('#btnNewGroup').on('click', function(){
            // check if user is logged in
            if (!sessionStorage.getItem('SessionID')) {
                Swal.fire({
                    title: "Not Logged In",
                    text: "You must be logged in to create a new group",
                    icon: "error",
                    showConfirmButton: true,
                    confirmButtonText: "Go To Login Page?",
                    showCancelButton: true,
                    cancelButtonText: "Stay Here",
                    customClass: {
                        actions: 'my-actions',
                        confirmButton: 'order-1 right-gap',
                        cancelButton: 'order-2'
                    },
                }).then((result) => {
                    if (result.isConfirmed) {
                        $('.card:visible').slideUp(function(){
                            $('#divLogin').slideDown();
                        });
                    }
                })
            } else {
                // Show sweetalert to create a group
                Swal.fire({
                    title: 'Create New Group',
                    text: 'Enter Group Name (atleast 3 characters long)',
                    input: 'text',
                    inputAttributes: {
                        autocapitalize: 'off'
                    },
                    showCancelButton: true,
                    confirmButtonText: 'Create Group',
                    inputValidator: (value) => {
                        if (!value || value.length < 3) {
                            return 'Input must be at least 3 characters long!';
                        }
                    }
                }).then((name) => {
                    if (name.isConfirmed) {
                        Swal.fire({
                            title: 'Password Protected?',
                            text: 'If you would like a password protected group, enter a password of atleast 3 characters. Otherwise, leave blank.',
                            input: 'password',
                            allowOutsideClick: false,
                            confirmButtonText: 'Finish Creating Group',
                            inputValidator: (value) => {
                                // If blank or 3 or more than ok
                                if (!value || value.length >= 3) {
                                    return false;
                                } else {
                                    return 'Password must be at least 3 characters long!';
                                }
                            }
                        }).then((password) => {
                            let strGroupName = name.value;
                            let strGroupPassword = password.value;

                            let formData = {
                                groupName: strGroupName,
                                ownerID: userID,
                                password: strGroupPassword
                            }

                            $.post('https://collegefootballbattleship-bae9a8eebbcaacff.eastus-01.azurewebsites.net/groups', formData, function(result){
                                $.post('https://collegefootballbattleship-bae9a8eebbcaacff.eastus-01.azurewebsites.net/groupmembers', {groupID:result.groupID, groupName:result.groupName, userID:userID, groupPassword:strGroupPassword}, function(res){
                                    if (!password.value) {
                                        Swal.fire({
                                            title: 'Group Created',
                                            text: 'Your group has been created successfully with no password!',
                                            icon: 'success'
                                        });
                                        formData = {
                                            groupID: result.groupID,
                                            userID: userID,
                                            week: 1,
                                            picksLeft: 7
                                        };
                                        $.get('https://collegefootballbattleship-bae9a8eebbcaacff.eastus-01.azurewebsites.net/groupmembers?groupID=' + result.groupID, function(groupMembers){
                                            let arrMembers = groupMembers.members;
                                            let numMembers = arrMembers.length;
                                            $.get('https://collegefootballbattleship-bae9a8eebbcaacff.eastus-01.azurewebsites.net/groupOwner?groupID=' + result.groupID, function(owner){
                                                addGroupRow(result.groupName, owner.owner, numMembers);
                                                addYourGroupRow(result.groupName, owner.owner, numMembers);
                                                addToPicksGroups(result.groupName, owner.owner);
                                            })
                                        })
                                    } else {
                                        Swal.fire({
                                            title: 'Group Created',
                                            text: 'Your group has been created successfully with a password!',
                                            icon: 'success'
                                        });
                                    }
                                })
                                let postData = {
                                    groupID: result.groupID,
                                    userID: userID
                                }
                                $.post('https://collegefootballbattleship-bae9a8eebbcaacff.eastus-01.azurewebsites.net/picksLeft', postData, function(res){
                                })
                            });                           
                        })
                    }
                });
            }
        });

        // When Group is clicked, ask if they want to join
        $('#tblGroups tbody').on('click', 'tr', function(){
            let strGroupName = $(this).find('td').eq(0).text();
            let strOwnerName = $(this).find('td').eq(1).text();
            let strNumMembers = $(this).find('td').eq(2).text();
            let strGroupID = $(this).attr('data-value');
            // Get first game to check if season has started
            $.get('https://collegefootballbattleship-bae9a8eebbcaacff.eastus-01.azurewebsites.net/firstGame', function(game){
                let gameStartTime = game.start_date;
                let gameStart = checkGameStart(gameStartTime);
                if (gameStart) {
                    Swal.fire({
                        title: 'Season Has Started',
                        text: 'The first game of the season has already started. You cannot join a group after the start of the season',
                        icon: 'warning'
                    });
                    return;
                } else {
                    // Get groupMembers to check if user is in group
                    $.get('https://collegefootballbattleship-bae9a8eebbcaacff.eastus-01.azurewebsites.net/groupmembers?groupID=' + strGroupID, function(result){
                        let arrMembers = result.members;
                        let blnUserInGroup = false;
                        arrMembers.forEach((member) => {
                            if (member.UserID == userID) {
                                blnUserInGroup = true;
                            }
                        })
                        if (blnUserInGroup) {
                            Swal.fire({
                                title: 'Already In Group',
                                text: 'You are already a member of this group!',
                                icon: 'warning'
                            });
                            return;
                        } else {
                            Swal.fire({
                                title: 'Join Group?',
                                text: 'Would you like to join the group "' + strGroupName + '" owned by ' + strOwnerName + ' with ' + strNumMembers + ' members?',
                                showCancelButton: true,
                                confirmButtonText: 'Join Group'
                            }).then((result) => {
                                if (result.isConfirmed) {
                                    // Check if group has password (if password in sql table is blank then no password), if so, ask for password (validate password using backend), otherwise join
                                    $.get('https://collegefootballbattleship-bae9a8eebbcaacff.eastus-01.azurewebsites.net/groupByID?groupID=' + strGroupID, function(result){
                                        if (result.Password) {
                                            Swal.fire({
                                                title: 'Enter Group Password',
                                                text: 'Please enter the password for the group "' + strGroupName + '"',
                                                input: 'password',
                                                confirmButtonText: 'Join Group',
                                                showCancelButton: true,
                                                inputValidator: (value) => {
                                                    if (!value || value.length < 3) {
                                                        return 'Password must be at least 3 characters long!';
                                                    }
                                                }
                                            }).then((input) => {
                                                if (input.isConfirmed) {
                                                    $.post('https://collegefootballbattleship-bae9a8eebbcaacff.eastus-01.azurewebsites.net/groupmembers', {groupID:strGroupID, groupName:strGroupName, userID:userID, groupPassword:input.value}, function(res){
                                                        if (!res.error) {
                                                            Swal.fire({
                                                                title: 'Group Joined',
                                                                text: 'You have successfully joined the group "' + strGroupName + '"!',
                                                                icon: 'success'
                                                            });
                                                            addYourGroupRow(strGroupName, strOwnerName, strNumMembers);
                                                            addToPicksGroups(strGroupName, strOwnerName);
                                                            let postData = {
                                                                groupID: strGroupID,
                                                                userID: userID
                                                            }
                                                            $.post('https://collegefootballbattleship-bae9a8eebbcaacff.eastus-01.azurewebsites.net/picksLeft', postData, function(res){
                                                            })
                                                        } else {
                                                            Swal.fire({
                                                                title: 'Incorrect Password',
                                                                text: 'Incorrect Password Given. Please try again.',
                                                                icon: 'error'
                                                            });
                                                        }
                                                    })
                                                }
                                            })
                                        } else {
                                            $.post('https://collegefootballbattleship-bae9a8eebbcaacff.eastus-01.azurewebsites.net/groupmembers', {groupID:strGroupID, groupName:strGroupName, userID:userID, groupPassword:''}, function(res){
                                                if (res) {
                                                    Swal.fire({
                                                        title: 'Group Joined',
                                                        text: 'You have successfully joined the group "' + strGroupName + '"!',
                                                        icon: 'success'
                                                    });
                                                    addYourGroupRow(strGroupName, strOwnerName, strNumMembers);
                                                    addToPicksGroups(strGroupName, strOwnerName)
                                                    let postData = {
                                                        groupID: strGroupID,
                                                        userID: userID
                                                    }
                                                    $.post('https://collegefootballbattleship-bae9a8eebbcaacff.eastus-01.azurewebsites.net/picksLeft', postData, function(res){
                                                    })
                                                } else {
                                                    Swal.fire({
                                                        title: 'Error',
                                                        text: 'There was an error joining the group. Please try again later.',
                                                        icon: 'error'
                                                    });
                                                }
                                            })
                                        }
                                    })
                                }
                            })
                        }
                    })
                }
            })
        })

        $('#tblYourGroups tbody').on('click', 'tr', function(){
            let strGroupID = $(this).attr('data-value');
            groupID = strGroupID;
            displayGroupMembersCard(strGroupID);
        });

        /*
            Functions for displaying an user's made picks
        */

        // Create the cards for the user's picks
        function createPicksCards(week, callback) {
            let strHTML =  `<div class="columnPicks">
                                <div  class="cardPicks">
                                    <h5>Week ${week}'s Picks</h5>
                                    <hr>
                                    <ol id="week${week}" style="list-style: number; text-align: left;"><ol>
                                </div>
                            </div>`;
            $('#divMemberPicks .card-body .row').append(strHTML);

            if (typeof callback === 'function') {
                callback();
            }
        }

        function addPicksToCard(week, picks) {
            picks.forEach((pick) => {
                if (pick.Week == week) {
                    let strHTML = `<li>${pick.PickedTeam}</li>`;
                    $(`#week${week}`).append(strHTML);
                }
            })
        }

        function displayPicksPerWeek(numPicks){
            let strHTML = `<ol class="week"></ol>`;
            $('#divMemberPicks .card-body .divider').before(strHTML);
            numPicks.forEach((pick) => {
                let strHTML = `<li>${pick.PicksLeft} Picks</li>`;
                $('#divMemberPicks .card-body .week').append(strHTML);
            })
        }

        $(document).on('click', '#tblGroupMembers tbody tr', function(){
            let strUserID = $(this).attr('data-value');
            let strGroupID = groupID;
            let strUsername = $(this).find('td').eq(0).text();
            let strHTML = ` 
                <div class="d-flex card-header justify-content-center">
                    <h3>${strUsername}'s Picks</h3>
                </div>
                <div class="d-flex card-body justify-content-center" style="flex-direction: column;">
                    <hr class="divider">
                    <div class="row">
                        
                    </div>
                </div>`;
            $('#divMemberPicks').html(strHTML);
            $('.card:visible').slideUp(function(){
                $('#divMemberPicks').slideDown();
            })

            // Get numPicks for the selected user
            $.get('https://collegefootballbattleship-bae9a8eebbcaacff.eastus-01.azurewebsites.net/allPicksLeft?userID=' + strUserID + '&groupID=' + strGroupID, function(result){
                console.log(result.picksLeft)
                displayPicksPerWeek(result.picksLeft);
            }); 

            // Get current week for displaying a user's picks (get week then subtract 1 so that you can't see this week's picks)
            $.get('https://collegefootballbattleship-bae9a8eebbcaacff.eastus-01.azurewebsites.net/weekNumber', function(weekNum){
                let intWeekNumber = weekNum.weekNumber;
                week = intWeekNumber - 1;

                // Get the picks for the selected player (needs groupID and userID)
                $.get('https://collegefootballbattleship-bae9a8eebbcaacff.eastus-01.azurewebsites.net/selections?groupID=' + strGroupID + '&userID=' + strUserID, function(result){
                    let picks = result.selections;
                    for (let i = 1; i <= week; i++) {
                        createPicksCards(i, function(){
                            addPicksToCard(i, picks)
                        })
                    }
                    strHTML = `<button id="btnGoBack" class="btn btn-primary col-12 mt-3" type="button">Go Back</button>`
                    $('#divMemberPicks .card-body').append(strHTML);
                })
            })
        })

        $(document).on('click', '#btnGoBack', function(){
            $('#divMemberPicks').slideUp(function(){
                $('#divGroupMembers').slideDown();
            })
        });

        /*
            Functionality for making picks
        */
        
        // Function to display the teams that the user has not yet picked
        // Change code so year updates automatically
        function displayValidPicks() {
            $.get('https://collegefootballbattleship-bae9a8eebbcaacff.eastus-01.azurewebsites.net/year', function(result){
                let year = result.year;
                $.get(`https://collegefootballbattleship-bae9a8eebbcaacff.eastus-01.azurewebsites.net/teams?year=${year}`, function(teams){
                    let arrValidTeams = [];
                    
                    // Get all fbs teams and add them to arrValidTeams
                    let promise1 = new Promise((resolve, reject) => {
                        teams.forEach((team, index, array) => {
                            arrValidTeams.push(team.school);
                            if (index === array.length - 1) resolve();
                        });
                    })

                    promise1.then(() => {
                        // Get all the teams that the user has already picked
                        $.get('https://collegefootballbattleship-bae9a8eebbcaacff.eastus-01.azurewebsites.net/selections?groupID=' + groupID + '&userID=' + userID, function(alreadyPicked){
                            let arrAlreadyPicked = [];

                            // add all the teams that the user has already picked to arrAlreadyPicked
                            let promise2 = new Promise((resolve, reject) => {
                                if (alreadyPicked.selections.length < 1) {
                                    resolve();
                                } else {
                                    alreadyPicked.selections.forEach((pick, index, array) => {
                                        arrAlreadyPicked.push(pick.PickedTeam.split(' {')[0]);
                                        if (index === array.length - 1) resolve();
                                    })
                                }
                            })

                            // Once all the teams have been added to arrAlreadyPicked, remove them from arrValidTeams
                            promise2.then(() => {
                                // Remove all the teams that the user has already picked from arrValidTeams
                                let promise3 = new Promise((resolve, reject) => {
                                    if(arrAlreadyPicked.length < 1) {
                                        resolve();
                                    } else {
                                        arrAlreadyPicked.forEach((team, index, array) => {
                                            let i = arrValidTeams.indexOf(team);
                                            if (i > -1) {
                                                arrValidTeams.splice(i, 1);
                                            }
                                            if (index === array.length - 1) resolve();
                                        })
                                    }
                                })

                                // Once all the teams have been removed from arrValidTeams, display the teams in the card
                                promise3.then(() => {
                                    arrValidTeams.forEach((team) => {
                                        let strHTML = `<li id='${team}'>${team}</li>`;
                                        $('#divMakePicks .scrollable ol').append(strHTML);
                                    })
                                })
                            })
                        })
                    });
                })
            })
        }
        
        // Displays the make picks card with needed information
        $(document).on('click', '#tblPicksGroups tbody tr', function(){
            groupID = $(this).attr('data-value');
            $.get('https://collegefootballbattleship-bae9a8eebbcaacff.eastus-01.azurewebsites.net/weekNumber', function(result){
                let intWeekNumber = result.weekNumber;
                week = intWeekNumber;

                if (week == 16){
                    week = 15;
                }

                let strHTML = '<h2>Make Picks for Week ' + intWeekNumber + '</h2>';
                $('#divMakePicks .card-header').html(strHTML);
                
                strHTML =  `<div class="row2">
                                <div class="columnYourGroups">
                                    <div class="cardGroupsScrollable">
                                        <div>
                                            <h5>Teams Remaining to be Picked</h5>
                                        </div>
                                        <hr>
                                        <div class="scrollable">
                                            <ol style="list-style: none; padding: 0;">
                                            </ol>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <hr>`;
                $('#divMakePicks .card-body').html(strHTML);
                displayValidPicks();
                $.get('https://collegefootballbattleship-bae9a8eebbcaacff.eastus-01.azurewebsites.net/weekData', function(result){
                    $.get('https://collegefootballbattleship-bae9a8eebbcaacff.eastus-01.azurewebsites.net/picksLeft?userID=' + userID + '&groupID=' + groupID, function(picksLeft){
                        let numPicks = picksLeft.picksLeft;
                        let gamesData = result

                        if (numPicks == 0) {
                            strHTML = `<p class="text-center">You no longer have picks in this group</p>`;
                            $('#divMakePicks .card-body').append(strHTML);
                            strHTML =  `<div class="d-flex col-12 justify-content-evenly">
                                            <button id="btnBackToPicks" type="button" class="btn btn-danger col-12">Go Back</button>
                                        </div>`
                            $('#divMakePicks .card-body').append(strHTML);
                            $('#divDashboard').slideUp(function(){
                                $('#divMakePicks').slideDown();
                            })
                        } else {
                            strHTML =  `<div class="row"></div>`
                            $('#divMakePicks .card-body').append(strHTML);
                            for (let i = 1; i <= numPicks; i++){
                                strHTML =  `<div class="columnPicks">
                                                <div class="cardPicks">
                                                    <h5>Pick ${i}</h5>
                                                    <hr>
                                                    <label for="selGames${i}" class="form-label mb-2">Select a Game:</label>
                                                    <select id="selGames${i}" class="form-label">
                                                        <option></option>
                                                    </select>
                                                    <label for"selTeams${i}" class="form-label mb-2">Select a Team:</label>
                                                    <select id="selTeams${i}">
                                                        <option></option>
                                                    </select>
                                                    <button id="btnMakePick${i}" type="button" class="btn btn-success col-12 mt-3 btn-make-pick">Confirm Pick</button>
                                                    <button id="btnChangePick${i}" type="button" class="btn btn-warning col-12 mt-3 btn-change-pick">Change Pick</button>
                                                </div>
                                            </div>`
                                $('#divMakePicks .card-body .row').append(strHTML)
                            }

                            /*
                                If user has made a pick in spot x, fill the game and team selectize boxes then disable the game and team selectize boxes, otherwise allow them to make a pick
                            */
                            $.get('https://collegefootballbattleship-bae9a8eebbcaacff.eastus-01.azurewebsites.net/selectionsByCurrentWeek?groupID=' + groupID + '&userID=' + userID, function(result){
                                let arrAlreadyPicked = result.selections;
                                for (let i = 1; i <= numPicks; i++){
                                    
                                    // Check if the user has already made a pick in this spot
                                    let match = arrAlreadyPicked.find(pick => pick.PickNum == i);
                                    if(match) {
                                        gameID = match.GameID;
                                        $.get('https://collegefootballbattleship-bae9a8eebbcaacff.eastus-01.azurewebsites.net/gameData?gameID=' + gameID, function(result){
                                            let strGameID = result[0].id;
                                            // Fill selGames{i} with all games then select the one the user has already picked
                                            let strHTML = "<option></option>";
                                            gamesData.forEach((game) => {
                                                let date = new Date(game.start_date).toDateString();
                                                strHTML += '<option value="' + game.id + '">' + game.away_team + ' at ' + game.home_team + ' {' + date + ' ' + convertTo12HourFormat(game.start_date) + '}</option>';
                                            })
                                            $(`#selGames${i}`).html(strHTML).selectize({
                                                placeholder: 'Select a game',
                                                sortField: 'text',
                                                onChange: function(value) {
                                                    // Get the selectize instance
                                                    var selectizeInstance = $(`#selGames${i}`)[0].selectize;
                                                    
                                                    // Use getItem to retrieve the selected option's text
                                                    var selectedOptionText = selectizeInstance.getItem(value).text();

                                                    // Split the text into away and home teams
                                                    var teams = selectedOptionText.split(" at ");
                                                    var awayTeam = teams[0] + ` {${gamesData.find(game => game.id == value).away_conference}}`;
                                                    var homeTeam = teams[1].split(" {")[0] + ` {${gamesData.find(game => game.id == value).home_conference}}`;

                                                    // Use the teams as needed, e.g., populating another selectize box
                                                    var $teamSelect = $(`#selTeams${i}`).selectize();
                                                    var control = $teamSelect[0].selectize;
                                                    control.clear();
                                                    control.clearOptions();
                                                    control.addOption({ value: awayTeam, text: awayTeam });
                                                    control.addOption({ value: homeTeam, text: homeTeam });
                                                    control.refreshOptions(false); // Refresh options without triggering onChange
                                                }
                                            });
                                            $(`#selTeams${i}`).selectize({
                                                placeholder: 'Select a team',
                                                sortField: 'text'
                                            });
                                            $(`#selGames${i}`).val(strGameID);
                                            $(`#selTeams${i}`).val(match.PickedTeam);

                                            // Disable the selectize boxes
                                            var selectizeGame = $(`#selGames${i}`)[0].selectize;
                                            selectizeGame.setValue(strGameID);
                                            selectizeGame.disable();
                                            var selectizeTeam = $(`#selTeams${i}`)[0].selectize;
                                            selectizeTeam.setValue(match.PickedTeam);
                                            selectizeTeam.disable();
                                        })
                                    } else {
                                        strHTML = "<option></option>";
                                        console.log(gamesData);
                                        gamesData.forEach((game) => {
                                            let date = new Date(game.start_date).toDateString();
                                            strHTML += '<option value="' + game.id + '">' + game.away_team + ' at ' + game.home_team + ' {' + date + ' ' + convertTo12HourFormat(game.start_date) + '}</option>';
                                        })
                                        $(`#selGames${i}`).html(strHTML).selectize({
                                            placeholder: 'Select a game',
                                            sortField: 'text',
                                            onChange: function(value) {
                                                // Get the selectize instance
                                                var selectizeInstance = $(`#selGames${i}`)[0].selectize;
                                                
                                                // Use getItem to retrieve the selected option's text
                                                var selectedOptionText = selectizeInstance.getItem(value).text();

                                                // Split the text into away and home teams
                                                var teams = selectedOptionText.split(" at ");
                                                var awayTeam = teams[0] + ` {${gamesData.find(game => game.id == value).away_conference}}`;
                                                var homeTeam = teams[1].split(" {")[0] + ` {${gamesData.find(game => game.id == value).home_conference}}`;

                                                // Use the teams as needed, e.g., populating another selectize box
                                                var $teamSelect = $(`#selTeams${i}`).selectize();
                                                var control = $teamSelect[0].selectize;
                                                control.clear();
                                                control.clearOptions();
                                                control.addOption({ value: awayTeam, text: awayTeam });
                                                control.addOption({ value: homeTeam, text: homeTeam });
                                                control.refreshOptions(false); // Refresh options without triggering onChange
                                            }
                                        });
                                        $(`#selTeams${i}`).selectize({
                                            placeholder: 'Select a team',
                                            sortField: 'text'
                                        });
                                    }

                                    
                                }
                                strHTML =  `<div class="d-flex col-12 justify-content-evenly">
                                                <button id="btnBackToPicks" type="button" class="btn btn-danger col-12">Go Back</button>
                                            </div>`
                                $('#divMakePicks .card-body .row').append(strHTML);
                                $('#divDashboard').slideUp(function(){
                                    $('#divMakePicks').slideDown();
                                })
                            })
                        }
                    })
                })
            })
       })

       // Go back to dashboard from make picks
       $(document).on('click', '#btnBackToPicks', function(){
            $('#divMakePicks').slideUp(function(){
                $('#divDashboard').slideDown();
            })
       })
       
        // Submit one pick at a time, make sure the chosen team hasn't been picked already
        $(document).on('click', '.btn-make-pick', function(){
            let buttonID = $(this).attr('id');
            // Extract the number from the id (assuming format btnMakePicksX)
            var i = buttonID.replace('btnMakePick', '');
            
            let strTimeStart = $(`#selGames${i}`).text().split(" {")[1].split("}")[0];
            let gameTime = new Date(strTimeStart);
            let currentTime = new Date();
            if (gameTime < currentTime) {
                Swal.fire({
                    title: 'Game Already Started',
                    text: 'This game has already started. Please select a different game.',
                    icon: 'error'
                });
            } else {
                let strGameID = $(`#selGames${i}`).val();
                let strTeamPicked = $(`#selTeams${i}`).val().split(" {")[0];
                let validTeams = document.querySelectorAll('#divMakePicks .scrollable ol li');
                let optionExists = false;
                validTeams.forEach((team) => {
                    if (team.id == strTeamPicked) {
                        optionExists = true;
                    }
                })

                // check if this selectize has been disabled
                var selectizeGame = $(`#selGames${i}`)[0].selectize;
                if (selectizeGame.isDisabled) {
                    Swal.fire({
                        title: 'Already Picked',
                        text: 'This pick has already been made. Please select a different pick.',
                        icon: 'error'
                    })
                }else if (!optionExists) {
                    Swal.fire({
                        title: 'Invalid Pick',
                        text: 'This team is not a valid pick (Already picked or non-FBS team)! Please select a team from the list above.',
                        icon: 'error'
                    })
                } else {
                    $.get('https://collegefootballbattleship-bae9a8eebbcaacff.eastus-01.azurewebsites.net/selections?groupID=' + groupID + '&userID=' + userID, function(result){
                        let arrAlreadyPicked = result.selections;

                        let blnPickedGame = false;
                        let blnPickedTeam = false;
                        
                        if (arrAlreadyPicked.length > 0) {
                            var promise = new Promise((resolve, reject) => {
                                arrAlreadyPicked.forEach((picked, index, array) => {
                                    if (strGameID == picked.GameID) {
                                        blnPickedGame = true;
                                    }
                                    if (strTeamPicked == picked.PickedTeam.split(" {")[0]) {
                                        blnPickedTeam = true;
                                    }
                                    if (index == array.length - 1) resolve();
                                })
                            })

                            promise.then(() => {
                                if (blnPickedGame) {
                                    Swal.fire({
                                        title: 'Game Already Picked',
                                        text: 'This game has already been picked by you. Please select a different game.',
                                        icon: 'error'
                                    });
                                } else if (blnPickedTeam) {
                                    Swal.fire({
                                        title: 'Team Already Picked',
                                        text: 'This team has already been picked by you. Please select a different team.',
                                        icon: 'error'
                                    });
                                } else {
                                    let strTeam = $(`#selTeams${i}`).val();
                                    let formData = {
                                        groupID: groupID,
                                        userID: userID,
                                        week: week,
                                        gameID: strGameID,
                                        pickedTeam: strTeam,
                                        pickNum: i
                                    }
                                    $.post('https://collegefootballbattleship-bae9a8eebbcaacff.eastus-01.azurewebsites.net/selection', formData, function(result){
                                        Swal.fire({
                                            title: 'Pick Made',
                                            text: 'Pick was successfully made!',
                                            icon: 'success'
                                        });
                                        var selectizeGame = $(`#selGames${i}`)[0].selectize;
                                        selectizeGame.disable();
                                        var selectizeTeam = $(`#selTeams${i}`)[0].selectize;
                                        selectizeTeam.disable();
                                        
                                        // Remove the team from the list of valid picks
                                        let team = strTeam.split(" {")[0];
                                        $(`#divMakePicks .scrollable ol [id='${team}']`).remove();
                                    })
                                }
                            })
                        } else {
                            let strTeam = $(`#selTeams${i}`).val();
                            let formData = {
                                groupID: groupID,
                                userID: userID,
                                week: week,
                                gameID: strGameID,
                                pickedTeam: strTeam,
                                pickNum: i
                            }
                            $.post('https://collegefootballbattleship-bae9a8eebbcaacff.eastus-01.azurewebsites.net/selection', formData, function(result){
                                Swal.fire({
                                    title: 'Pick Made',
                                    text: 'Pick was successfully made!',
                                    icon: 'success'
                                });
                                var selectizeGame = $(`#selGames${i}`)[0].selectize;
                                selectizeGame.disable();
                                var selectizeTeam = $(`#selTeams${i}`)[0].selectize;
                                selectizeTeam.disable();

                                // Remove the team from the list of valid picks
                                let team = strTeam.split(" {")[0];
                                $(`#divMakePicks .scrollable ol [id='${team}']`).remove();
                            })
                        }
                    })
                }
            }
        })

        // Change a pick
        $(document).on('click', '.btn-change-pick', function(){
            let buttonID = $(this).attr('id');
            // Extract the number from the id (assuming format btnMakePicksX)
            var i = buttonID.replace('btnChangePick', '');

            // check if this selectize has been disabled        (Add Code to delete pick and re-enable selectize)
            var selectizeGame = $(`#selGames${i}`)[0].selectize;
            if (selectizeGame.isDisabled) {
                // Get the gameID and team that the user has already picked
                let strGameID = $(`#selGames${i}`).val();
                let strTeam = $(`#selTeams${i}`).val();

                // Delete the pick
                $.ajax({
                    url: 'https://collegefootballbattleship-bae9a8eebbcaacff.eastus-01.azurewebsites.net/selections?groupID=' + groupID + '&userID=' + userID + '&gameID=' + strGameID,
                    type: 'DELETE',
                    success: function(result){
                        // Enable the selectize boxes
                        selectizeGame.enable();
                        var selectizeTeam = $(`#selTeams${i}`)[0].selectize;
                        selectizeTeam.enable();
                        Swal.fire({
                            title: 'Pick Deleted',
                            text: 'Pick was successfully deleted! Please make a new pick.',
                            icon: 'warning'
                        });
                        // Redisplay the valid picks
                        $('#divMakePicks .scrollable ol').html('');
                        displayValidPicks();
                    }
                })
            } else {
                Swal.fire({
                    icon: 'error',
                    title: "Can't Change Pick",
                    text: "You can't change a pick that hasn't been made yet!"
                })
            }
        });
                
    </script>
</body>
</html>